<% section = $model %>

<div class="menu">
  <table>
    <tr>
      <td><div class="menu_item"><%= linkToUnitPage "Unit Summary" %></div></td>
	  <td><div class="menu_item"><%= linkToObject "CSV", section, $section_csv_view %></div></td>
    </tr>
  </table>
</div>

<hr />

<div id="content">
  <h2>Section: <%= sectionTitle %></h2>
  
  <h3>Learning Goals</h3>
  <%= $model.goals.gsub(/$/, "<br/>") if $model.goals %>
  
  <h3>Questions</h3>
  <table>
    <% question_correct = {}; question_answered = {}; num_users = 0; gradable_questions = 0 %>
      
    <tr>
      <th>User</th>
      <% questions = basicSectionQuestions %>
      <% questions.each do |question| %>
          <% gradable_questions += 1 if questionGradable(question) %>
          <% question_correct[question] = 0; question_answered[question] = 0 %>
        <th><%= popupLinkToObject truncate(promptText(question), 30), question %></th>  
      <% end %>
      <th>Score: Correct/ Answered/ Possible </th>
    </tr>
    <% line_toggle = true %>
    <% @users.each do |user| %>
      <% num_users += 1 %>
      <tr BGCOLOR = <%= line_toggle ? ROWCOLOR1 : ROWCOLOR2 %>>
        <% line_toggle = !line_toggle %>
        <td><%= linkToObject user.name, user, $user_view %></td>
        <% user_correct = 0; user_answered = 0 %>
        <% questions.each do |question| %>
          <% userQuestion = userObject(question, user) %>
          <% if questionCorrect(userQuestion) 
               user_correct += 1 
               question_correct[question] += 1
             end 
             
             if questionAnswered(userQuestion) and questionGradable(question)
               user_answered += 1
               question_answered[question] += 1               
             end
             %>
          <td><%= questionAnswerHtml userQuestion %></td>  
        <% end %>        
        <td><%= "#{user_correct}/#{user_answered}/#{gradable_questions}" %></td>
      </tr>
    <% end %>
      <tr>
        <td>Score: Correct/ Answered/ Possible</td>
        <% questions.each do |question| %>
          <td>
            <% if questionGradable(question) %>             
              <%= "#{question_correct[question]}/#{question_answered[question]}/#{num_users}" %>
            <% else %>
              N/A
            <% end %>
          </td>
        <% end %>
        <td>Class Score?<td/>                
      </tr>
      
    <% if preOrPost? %>
      <tr BGCOLOR = <%= line_toggle ? ROWCOLOR1 : ROWCOLOR2 %>>
        <% line_toggle = !line_toggle %>
        <td>Activity References</td>
        <% questions.each do |question| %>
          <td><%= activityRefString(question) %></td>
        <% end %>
      </tr>
    <% end %>
  </table>

  <% if preOrPost? %>
    <p/>
    <h4>Activity Index</h4>
    <table>  
      <% unitSections.size.times do |i| %>
        <tr><td><%= i.to_s %></td><td><%= unitSections[i].getName %></td></tr>
      <% end %>
    </table>
  <% end %>
</div>